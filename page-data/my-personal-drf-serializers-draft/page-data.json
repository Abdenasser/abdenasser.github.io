{"componentChunkName":"component---src-templates-post-js","path":"/my-personal-drf-serializers-draft","result":{"data":{"site":{"siteMetadata":{"title":"abdenasser.com","author":"Abdenasser Elidrissi"}},"markdownRemark":{"id":"548e8fa8-d9f4-5c3a-8e69-238c3926871c","excerpt":"Before today it was only me and god who can read my hand writing, but today it is only god who can‚Ä¶ today I got stuck reading one of my DRF drafts about  and‚Ä¶","html":"<p>Before today it was only me and god who can read my hand writing, but today it is only god who can‚Ä¶ today I got stuck reading one of my DRF drafts about <code class=\"language-text\">serializers</code> and decided that it‚Äôs that time of the year again where I start thinking that I should have a blog where I can save my notes -then forget about it again-, but as I already got a blog I said why not ü§î ? ‚Ä¶ let‚Äôs create a digital copy of my drf serializer notes, maybe someone will find it useful.</p>\n<blockquote>\n<p>save time creating django apis with <a href=\"https://github.com/Abdenasser/dr_scaffold\">this cool django package</a>, and support the repository by dropping a star ‚≠ê</p>\n</blockquote>\n<hr>\n<p>Let‚Äôs define an Index or a table of content that we can use as reference in the future.</p>\n<h2>Table of content</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1 - Fields\n  --------------------------\n  - Serializer Method Field\n  - Read Only Field\n  - Custom Field Validation\n  - Using Multiple Serializers\n  --------------------------\n2 - Data\n  --------------------------\n  - Custom Data Validation\n  - Custom Output with `to_representation`()\n  - Custom Input with `to_internal_value`().\n  - Pass additional data directly to `save()`\n  --------------------------\n3 - Keywords\n  --------------------------\n  - The `source` Keyword\n  - The `context` Keyword</code></pre></div>\n<br>\n<hr>\n<h2>1- Fields</h2>\n<h3>Serializer Method Field</h3>\n<p>This is a read-only field. It gets its value by calling a method on the serializer class it is attached to. It can be used to add any sort of data to the serialized representation of your object.</p>\n<p><code class=\"language-text\">SerializerMethodField</code> gets its data by calling <code class=\"language-text\">get_&lt;field_name></code>.</p>\n<p>Example:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    days_since_joined <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>SerializerMethodField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> User\n        fields <span class=\"token operator\">=</span> <span class=\"token string\">'__all__'</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_days_since_joined</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> obj<span class=\"token punctuation\">.</span>date_joined<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>days</code></pre></div>\n<h3>Read Only Field</h3>\n<p>Read-only fields are included in the API output, but should not be included in the input during create or update operations. Any <code class=\"language-text\">read_only</code> fields that are incorrectly included in the serializer input will be ignored.</p>\n<p>Example:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AccountSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>Serializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'ID'</span><span class=\"token punctuation\">,</span> read_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Custom Field Validation</h3>\n<p>Validation in Django REST framework serializers is handled a little differently to how validation works in Django‚Äôs ModelForm class.</p>\n<p>With ModelForm the validation is performed partially on the form, and partially on the model instance. With REST framework the validation is performed entirely on the serializer class.</p>\n<p>Let‚Äôs take an example where we want to only allow students that have age between 12 and 18:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">StudentSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">validate_age</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> age <span class=\"token operator\">></span> <span class=\"token number\">18</span> <span class=\"token keyword\">or</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">12</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> serializers<span class=\"token punctuation\">.</span>ValidationError<span class=\"token punctuation\">(</span><span class=\"token string\">'Age has to be between 12 and 18.'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> age</code></pre></div>\n<h3>Using Multiple Serializers</h3>\n<p>You can override the <code class=\"language-text\">get_serializer_class()</code> of your <code class=\"language-text\">ViewSet</code> when for example you want to use a different Serializer in your create and update actions like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyViewSet</span><span class=\"token punctuation\">(</span>viewsets<span class=\"token punctuation\">.</span>ModelViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    queryset <span class=\"token operator\">=</span> MyModel<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_serializer_class</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>action <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> WriteSerializer\n        <span class=\"token keyword\">return</span> ReadSerializer</code></pre></div>\n<br>\n<hr>\n<h2>2- Data</h2>\n<h3>Custom Data Validation</h3>\n<p>Besides <strong>Custom Field Validation</strong>, there are two additional ways we can use to validate our data, when for example we need to compare some of our fields between each other the best way to do that is on the object level.</p>\n<p>example:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'discount_amount'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'total_amount'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> serializers<span class=\"token punctuation\">.</span>ValidationError<span class=\"token punctuation\">(</span><span class=\"token string\">'discount cannot be bigger than the total amount'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> data</code></pre></div>\n<p>Another good way to do validation is when a validation logic is repeated multiple times in some serializers, you can then extract it to a function, example:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">is_valid_age</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> age <span class=\"token operator\">&lt;</span> <span class=\"token number\">12</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> serializers<span class=\"token punctuation\">.</span>ValidationError<span class=\"token punctuation\">(</span><span class=\"token string\">'age cannot be lower than 12.'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">elif</span> age <span class=\"token operator\">></span> <span class=\"token number\">18</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> serializers<span class=\"token punctuation\">.</span>ValidationError<span class=\"token punctuation\">(</span><span class=\"token string\">'age cannot be higher than 18'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then you can pass it like this in the other serializers:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">AnotherSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    age <span class=\"token operator\">=</span> IntegerField<span class=\"token punctuation\">(</span>validators<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>is_valid_age<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Custom Output with <code class=\"language-text\">to_representation()</code></h3>\n<p>When you want to customize the output right before it is sent use <code class=\"language-text\">to_representation()</code>, imagine you have an output like the following after serialization is completed:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"abdenasser\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"bio\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hey ... you already know!\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"followed_by\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and you want to add a total followers count to it‚Ä¶ you can simply do:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ResourceSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">to_representation</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        representation <span class=\"token operator\">=</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to_representation<span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">)</span>\n        representation<span class=\"token punctuation\">[</span><span class=\"token string\">'followers'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> instance<span class=\"token punctuation\">.</span>followed_by<span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> representation</code></pre></div>\n<p>Then you‚Äôll get:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"abdenasser\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"bio\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hey ... you already know!\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"followed_by\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"followers\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Custom Input with <code class=\"language-text\">to_internal_value()</code></h3>\n<p>Let‚Äôs say that your API is expecting some input from a 3rd party service and you are only interested in a chunk of that input, you can use <code class=\"language-text\">to_internal_value()</code> as follow:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">SomeSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">to_internal_value</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        useful_data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'useful'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to_internal_value<span class=\"token punctuation\">(</span>useful_data<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Pass additional data directly to save()</h3>\n<p>Calling <code class=\"language-text\">.save()</code> will either create a new instance, or update an existing instance, depending on if an existing instance was passed when instantiating the serializer class:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># .save() will create a new instance.</span>\nserializer <span class=\"token operator\">=</span> CommentSerializer<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># .save() will update the existing `comment` instance.</span>\nserializer <span class=\"token operator\">=</span> CommentSerializer<span class=\"token punctuation\">(</span>comment<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<hr>\n<h2>3- Keywords</h2>\n<h3>The source Keyword</h3>\n<p>In essence, you can use <code class=\"language-text\">source</code> in a field like this</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">field_name <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>SomeFieldType<span class=\"token punctuation\">(</span>source<span class=\"token operator\">=</span><span class=\"token string\">'prop'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>where <code class=\"language-text\">prop</code> could be a call for a function that return some value, or a property that exists in a related model like <code class=\"language-text\">...(source='author.bio')</code> or even a serializer field that you want to rename in output.</p>\n<p>You can also attach the whole object with <code class=\"language-text\">source='*'</code> if you need.</p>\n<h3>The context Keyword</h3>\n<p>You can provide arbitrary additional context by passing a context argument when instantiating a serializer. For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">resource <span class=\"token operator\">=</span> Resource<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\nserializer <span class=\"token operator\">=</span> ResourceSerializer<span class=\"token punctuation\">(</span>resource<span class=\"token punctuation\">,</span> context<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'value'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The context dictionary can then be used within any serializer field logic, such as a custom .to_representation() method, by accessing the self.context attribute.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">to_representation</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    representation <span class=\"token operator\">=</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to_representation<span class=\"token punctuation\">(</span>instance<span class=\"token punctuation\">)</span>\n    representation<span class=\"token punctuation\">[</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">[</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">return</span> representation</code></pre></div>\n<br>\n<h2>Final word:</h2>\n<p>Django Rest Framework has a very good documentation which you can find and read <a href=\"https://www.django-rest-framework.org/\">here</a>, try to spend some time on it and use it as a fall back any time you feel that things started getting complicated in your serializers, also bare in mind that while you are using serializers you are most of the time using, overriding or extending the base serializer functionalities so go check it out and take a look at it <a href=\"https://github.com/encode/django-rest-framework/blob/master/rest_framework/serializers.py\">here</a>.</p>","frontmatter":{"title":"My personal django rest framework serializer notes","date":"August 26, 2021","spoiler":"A use case driven draft, UDD ü§î !!","tags":["django","apis","notes"]}}},"pageContext":{"slug":"my-personal-drf-serializers-draft"}},"staticQueryHashes":["2589769190"]}